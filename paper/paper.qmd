---
title: "Predicting the 2024 US Presidential Election: A Polling-Based Forecast"
subtitle: "My subtitle if needed"
author: 
  - Tianrui Fu
  - Yiyue Deng
thanks: "Code and data are available at: [https://github.com/RohanAlexander/starter_folder](https://github.com/RohanAlexander/starter_folder)."
date: today
date-format: long
abstract: "This paper forecasts the 2024 US Presidential election outcome using polling data from [insert pollster name]. By applying simple and multiple linear regression models, we analyze the effect of polling factors, including sample size, poll score, and transparency, on support percentages for key candidates. Our findings suggest significant relationships between these variables, providing an evidence-based approach to predicting election outcomes. We further explore methodological strengths and weaknesses and propose an ideal polling survey methodology. This work highlights the potential for data-driven insights into political forecasting."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(arrow)
library(kableExtra)
library(ggplot2)
library(dplyr)
```


# Introduction {#sec-data}

Overview paragraph

Estimand paragraph

Results paragraph

Why it matters paragraph

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}

## Overview

We use the statistical programming language R [@citeR].... Our data [@shelter].... Following @tellingstories, we consider...


```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: tbl-dataset-example
#| tbl-cap: The example of chosen variable datset
#| echo: false
set.seed(123)
analysis_data <- read_parquet(here::here("data/02-analysis_data/analysis_data.parquet"))
example_dataset <- analysis_data[sample(1:nrow(analysis_data), 10), c("pollster", "pollscore", "numeric_grade", "transparency_score", "end_date", "pct")]
kable(example_dataset, col.names = c("pollster", "pollscore", "numeric_grade", "transparency_score", "end_date", "pct")) %>%
  kable_styling() %>%
  row_spec(0, bold = TRUE) %>%
  row_spec(0, extra_css = "border-bottom: 2px solid black;")  
```

## Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.

## Outcome variables

Add graphs, tables and text. Use sub-sub-headings for each outcome variable or update the subheading to be singular.



Some of our data is of penguins (@fig-bills), from[]. 
```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: fig-percentage-pollster
#| fig-cap: Percentage of Each Pollster Over Time
#| echo: false
ggplot(analysis_data, aes(x = end_date, y = pct, fill = pollster)) +
  geom_area(position = "stack", alpha = 0.7) +
  labs(x = "End Date", y = "Percentage (%)") +
  theme_minimal()
```

```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: fig-pct-density
#| fig-cap: Density plot of pct
#| echo: false
ggplot(analysis_data, aes(x = pct)) +
  geom_density(fill = "lightblue", color = "blue", alpha = 0.5) +
  labs(title = "Density Plot of Pct", x = "Pct", y = "Density") +
  theme_minimal()
```
## Predictor variables

Add graphs, tables and text.

Use sub-sub-headings for each outcome variable and feel free to combine a few into one if they go together naturally.

```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: fig-frequency-bar
#| fig-cap: Frequency of each pollster
#| echo: false
ggplot(analysis_data, aes(y = reorder(pollster, table(pollster)[pollster]))) +  
  geom_bar(aes(fill = after_stat(count)), color = "black") +                          
  geom_text(stat = "count", aes(label = after_stat(count)), hjust = -0.1, size = 2) +  
  scale_fill_gradient(low = "lightblue", high = "blue") +
  labs(x = "Count", y = "Pollster") +       
  theme_minimal() +
  theme(axis.text.x = element_text(size = 8)) 
```
```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: fig-avg-pollscore
#| fig-cap: Average Pollscore by Pollster and End Date
#| echo: false
library(dplyr)

heatmap_data <- analysis_data %>%
  group_by(pollster, end_date) %>%
  summarise(mean_pollscore = mean(pollscore, na.rm = TRUE), .groups = "drop") 

ggplot(heatmap_data, aes(x = end_date, y = pollster, fill = mean_pollscore)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(x = "End Date", y = "Pollster", fill = "Avg Pollscore") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(size = 8))
  
```
```{r, fig.pos= 'H', fig.width=8, fig.height=4}
#| label: fig-plot
#| fig-cap: Scatter Plot of transparency score and numeric grade
#| echo: false
#| message: false
#| warning: false
suppressWarnings({
  ggplot(analysis_data, aes(x = transparency_score, y = numeric_grade)) +
    geom_point(color = "darkblue", alpha = 0.6) +
    geom_smooth(method = "lm", color = "red", se = FALSE) +
    labs(x = "Transparency Score", y = "Numeric Grade") +
    theme_minimal()
})
```

# Model {#sec-data}

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up
Define $y_i$ as the percentage. Then $\beta_i$ represents the numeric grade, $\gamma_i$ represents the transparency score, and $\delta_i$ represents the pollscore.

\begin{align}
y_i|\mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_1 \cdot \text{numeric\_grade}_i + \beta_2 \cdot \text{transparency\_score}_i + \beta_3 \cdot \text{pollscore}_i \\
&\quad + \sum_{j=1}^{N} \gamma_j \cdot \text{pollster}_j + \delta_i \cdot \text{end\_date}_i \\
\alpha &\sim \text{Normal}(50, 10) \\
\beta_1, \beta_2, \beta_3 &\sim \text{Normal}(0, 5) \\
\gamma_j &\sim \text{Normal}(0, 5) \\
\sigma &\sim \text{Exponential}(1)
\end{align}
We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results {#sec-data}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)
library(here)

model_final_glm <-
  readRDS(file = here::here("models/model_final.rds"))
model_bayes <-
  readRDS(file = here::here("models/model_bayes.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false
library(modelsummary)
library(kableExtra)
library(dplyr)
coef_names <- c("end_date" = "End Date",
                "pollsterBeacon/Shaw" = "Beacon/Shaw",
                "pollsterChristopher Newport U." = "Christopher Newport U.",
                "pollsterCNN/SSRS" = "CNN/SSRS",
                "pollsterData Orbital" = "Data Orbital",
                "pollsterEchelon Insights" = "Echelon Insights",
                "pollsterEmerson" = "Emerson",
                "pollsterIpsos" = "Ipsos",
                "pollsterMarist" = "Marist",
                "pollsterMarquette Law School" = "Marquette Law School",
                "pollsterMassINC Polling Group" = "MassINC Polling Group",
                "pollsterMcCourtney Institute/YouGov" = "McCourtney Institute/YouGov",
                "pollsterMuhlenberg" = "Muhlenberg",
                "pollsterQuinnipiac" = "Quinnipiac",
                "pollsterSelzer" = "Selzer",
                "pollsterSiena" = "Siena",
                "pollsterSiena/NYT" = "Siena/NYT",
                "pollsterSuffolk" = "Suffolk",
                "pollsterSurveyUSA" = "SurveyUSA",
                "pollsterSurveyUSA/High Point University" = "SurveyUSA/High Point University",
                "pollsterThe Washington Post" = "The Washington Post",
                "pollsterU. North Florida" = "U. North Florida",
                "pollsterUniversity of Massachusetts Lowell/YouGov" = "University of Massachusetts Lowell/YouGov",
                "pollsterWashington Post/George Mason University" = "Washington Post/George Mason University",
                "pollsterYouGov" = "YouGov",
                "pollsterYouGov Blue" = "YouGov Blue",
                "pollsterYouGov/Center for Working Class Politics" = "YouGov/Center for Working Class Politics")
                
modelsummary(models = list("Model by glm" = model_final_glm, 
                           "Model by bayes" = model_bayes),
             statistic = "conf.int",
             conf_level = 0.95,
             stars = TRUE,
             coef_rename = coef_names,
             output = "kableExtra") %>%
  kable_styling(full_width = F, position = "left", bootstrap_options = c("striped", "hover"
                                                                           , line_height = 6)) %>%
  column_spec(column = 2, width = "2em") %>%
  column_spec(column = 2, width = "4em") %>%
  add_header_above(c(" " = 1, "Model Summary" = 2)) %>%
  kable_classic(full_width = F, font_size = 4) %>%
  add_footnote("This table shows the regression models with custom variable names.")

```




# Discussion {#sec-data}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

```



\newpage


# References


